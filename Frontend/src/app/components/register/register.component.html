<div class="auth-container">
  <!-- Power aura effects -->
  <div class="power-effects">
    <div class="aura-ring aura-1"></div>
    <div class="aura-ring aura-2"></div>
    <div class="aura-ring aura-3"></div>
    <div class="ki-particles">
      <div class="ki-particle"></div>
      <div class="ki-particle"></div>
      <div class="ki-particle"></div>
      <div class="ki-particle"></div>
      <div class="ki-particle"></div>
    </div>
  </div>

  <div class="auth-layout">
    <!-- Left Side: Goku Flying Nimbus -->
    <div class="model-section model-left" *ngIf="!isGoogleRegister">
      <div class="model-container">
        <iframe title="Goku Flying Nimbus" frameborder="0" allowfullscreen mozallowfullscreen="true"
          webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking"
          src="https://sketchfab.com/models/8cf7d591a0144ab085d8b1e042ad7a6b/embed?ui_theme=dark&ui_controls=0&ui_infos=0&ui_stop=0&autostart=1&transparent=1">
        </iframe>
      </div>
    </div>

    <!-- Center: Register Form -->
    <div class="auth-content">
      <div class="auth-card animate-fade-in" [class.google-card]="isGoogleRegister">

        <!-- ========== GOOGLE OAUTH REGISTRATION (Different UI) ========== -->
        <ng-container *ngIf="isGoogleRegister && !showOtpInput">
          <div class="google-welcome-header">
            <div class="google-avatar">
              <mat-icon>account_circle</mat-icon>
            </div>
            <h1 class="power-title">‚ö° COMPLETE YOUR PROFILE</h1>
            <p class="power-subtitle">Welcome, {{ googleUserName }}! Fill in your power stats.</p>
          </div>

          <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form google-form">
            <!-- Name (editable but pre-filled) -->
            <mat-form-field appearance="outline" class="full-width power-field">
              <mat-label>Your Name</mat-label>
              <mat-icon matPrefix class="field-icon">person</mat-icon>
              <input matInput formControlName="name" placeholder="Your warrior name">
            </mat-form-field>

            <div class="section-title google-section-title">
              <mat-icon>insights</mat-icon>
              <span>Your Power Stats</span>
            </div>

            <div class="google-stats-grid">
              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Age</mat-label>
                <mat-icon matPrefix class="field-icon">cake</mat-icon>
                <input matInput type="number" formControlName="age" placeholder="25">
              </mat-form-field>

              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Height (cm)</mat-label>
                <mat-icon matPrefix class="field-icon">height</mat-icon>
                <input matInput type="number" formControlName="height" placeholder="175">
              </mat-form-field>

              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Weight (kg)</mat-label>
                <mat-icon matPrefix class="field-icon">fitness_center</mat-icon>
                <input matInput type="number" formControlName="weight" placeholder="70">
              </mat-form-field>

              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Gender</mat-label>
                <mat-icon matPrefix class="field-icon">wc</mat-icon>
                <mat-select formControlName="gender">
                  <mat-option *ngFor="let gender of genders" [value]="gender">{{ gender }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="full-width power-field goal-field">
              <mat-label>üéØ Your Fitness Goal</mat-label>
              <mat-select formControlName="goal">
                <mat-option *ngFor="let goal of goals" [value]="goal">
                  <span class="goal-option">
                    <mat-icon *ngIf="goal === 'weight loss'">trending_down</mat-icon>
                    <mat-icon *ngIf="goal === 'muscle gain'">fitness_center</mat-icon>
                    <mat-icon *ngIf="goal === 'maintenance'">balance</mat-icon>
                    {{ goal | titlecase }}
                  </span>
                </mat-option>
              </mat-select>
            </mat-form-field>

            <button mat-raised-button type="submit" class="submit-btn google-submit"
              [disabled]="!registerForm.valid || loading">
              <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
              <span *ngIf="!loading">üöÄ BEGIN TRAINING</span>
            </button>
          </form>
        </ng-container>

        <!-- ========== NORMAL REGISTRATION ========== -->
        <ng-container *ngIf="!isGoogleRegister">
          <div class="auth-header">
            <div class="power-icon">
              <mat-icon class="logo-icon">fitness_center</mat-icon>
              <div class="power-glow"></div>
            </div>
            <h1 class="power-title" *ngIf="!showOtpInput">JOIN THE Z-TEAM</h1>
            <h1 class="power-title" *ngIf="showOtpInput">üîê VERIFY EMAIL</h1>
            <p class="power-subtitle" *ngIf="!showOtpInput">Begin your transformation today</p>
            <p class="power-subtitle" *ngIf="showOtpInput">Enter the OTP sent to {{ pendingEmail }}</p>
          </div>

          <!-- OTP Verification Section -->
          <div *ngIf="showOtpInput" class="otp-section">
            <div class="otp-timer" *ngIf="otpTimer > 0">
              <mat-icon>timer</mat-icon>
              <span>Expires in: {{ formatTime(otpTimer) }}</span>
            </div>
            <div class="otp-timer expired" *ngIf="otpTimer <= 0">
              <mat-icon>warning</mat-icon>
              <span>OTP Expired - Request a new one</span>
            </div>

            <mat-form-field appearance="outline" class="full-width power-field otp-field">
              <mat-label>Enter 6-digit OTP</mat-label>
              <mat-icon matPrefix class="field-icon">pin</mat-icon>
              <input matInput type="text" [(ngModel)]="otpValue" maxlength="6" placeholder="000000"
                style="letter-spacing: 8px; font-size: 24px; text-align: center;">
            </mat-form-field>

            <button mat-raised-button class="submit-btn" (click)="verifyOtp()"
              [disabled]="loading || otpValue.length !== 6">
              <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
              <span *ngIf="!loading">‚ö° VERIFY OTP</span>
            </button>

            <div class="otp-actions">
              <button mat-button (click)="resendOtp()" [disabled]="loading || otpTimer > 540">
                <mat-icon>refresh</mat-icon> Resend OTP
              </button>
              <button mat-button (click)="goBackToForm()">
                <mat-icon>arrow_back</mat-icon> Back to Form
              </button>
            </div>
          </div>

          <!-- Registration Form (Normal) -->
          <form *ngIf="!showOtpInput" [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form">
            <div class="form-row">
              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Full Name</mat-label>
                <mat-icon matPrefix class="field-icon">person</mat-icon>
                <input matInput formControlName="name" placeholder="John Doe">
                <mat-error *ngIf="registerForm.get('name')?.hasError('required')">Name is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Email</mat-label>
                <mat-icon matPrefix class="field-icon">email</mat-icon>
                <input matInput type="email" formControlName="email" placeholder="john@example.com">
                <mat-error *ngIf="registerForm.get('email')?.hasError('required')">Email is required</mat-error>
                <mat-error *ngIf="registerForm.get('email')?.hasError('email')">Invalid email</mat-error>
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="full-width power-field">
              <mat-label>Password</mat-label>
              <mat-icon matPrefix class="field-icon">lock</mat-icon>
              <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password"
                placeholder="Min 6 characters">
              <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
                <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <mat-error *ngIf="registerForm.get('password')?.hasError('required')">Password is required</mat-error>
              <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">Min 6 characters</mat-error>
            </mat-form-field>

            <div class="section-title" style="color: #ff6b35; margin-top: 4px;">
              <mat-icon style="color: #ffd700">insights</mat-icon>
              <span>Physical Specs</span>
            </div>

            <div class="form-row triple">
              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Age</mat-label>
                <input matInput type="number" formControlName="age" placeholder="25">
              </mat-form-field>

              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Height (cm)</mat-label>
                <input matInput type="number" formControlName="height" placeholder="175">
              </mat-form-field>

              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Weight (kg)</mat-label>
                <input matInput type="number" formControlName="weight" placeholder="70">
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Gender</mat-label>
                <mat-icon matPrefix class="field-icon">wc</mat-icon>
                <mat-select formControlName="gender">
                  <mat-option *ngFor="let gender of genders" [value]="gender">{{ gender }}</mat-option>
                </mat-select>
                <mat-error *ngIf="registerForm.get('gender')?.hasError('required')">Required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="power-field">
                <mat-label>Fitness Goal</mat-label>
                <mat-icon matPrefix class="field-icon">flag</mat-icon>
                <mat-select formControlName="goal">
                  <mat-option *ngFor="let goal of goals" [value]="goal">
                    <span class="goal-option">
                      <mat-icon *ngIf="goal === 'weight loss'">trending_down</mat-icon>
                      <mat-icon *ngIf="goal === 'muscle gain'">fitness_center</mat-icon>
                      <mat-icon *ngIf="goal === 'maintenance'">balance</mat-icon>
                      {{ goal | titlecase }}
                    </span>
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="registerForm.get('goal')?.hasError('required')">Required</mat-error>
              </mat-form-field>
            </div>

            <button mat-raised-button type="submit" class="submit-btn" [disabled]="!registerForm.valid || loading">
              <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
              <span *ngIf="!loading">‚ö° Register</span>
            </button>
          </form>

          <div class="divider" *ngIf="!showOtpInput">
            <span class="divider-line"></span>
            <span class="divider-text">OR</span>
            <span class="divider-line"></span>
          </div>

          <!-- Google OAuth Button -->
          <app-google-button *ngIf="!showOtpInput"></app-google-button>

          <div class="auth-footer" *ngIf="!showOtpInput">
            <p>Already have an account? <a routerLink="/login">Sign In</a></p>
          </div>
        </ng-container>

        <!-- OTP Section for Google Users -->
        <ng-container *ngIf="isGoogleRegister && showOtpInput">
          <div class="google-welcome-header">
            <div class="google-avatar">
              <mat-icon>verified</mat-icon>
            </div>
            <h1 class="power-title">üîê VERIFY EMAIL</h1>
            <p class="power-subtitle">Enter the OTP sent to {{ pendingEmail }}</p>
          </div>

          <div class="otp-section">
            <div class="otp-timer" *ngIf="otpTimer > 0">
              <mat-icon>timer</mat-icon>
              <span>Expires in: {{ formatTime(otpTimer) }}</span>
            </div>
            <div class="otp-timer expired" *ngIf="otpTimer <= 0">
              <mat-icon>warning</mat-icon>
              <span>OTP Expired - Request a new one</span>
            </div>

            <mat-form-field appearance="outline" class="full-width power-field otp-field">
              <mat-label>Enter 6-digit OTP</mat-label>
              <mat-icon matPrefix class="field-icon">pin</mat-icon>
              <input matInput type="text" [(ngModel)]="otpValue" maxlength="6" placeholder="000000"
                style="letter-spacing: 8px; font-size: 24px; text-align: center;">
            </mat-form-field>

            <button mat-raised-button class="submit-btn google-submit" (click)="verifyOtp()"
              [disabled]="loading || otpValue.length !== 6">
              <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
              <span *ngIf="!loading">‚ö° VERIFY & JOIN</span>
            </button>

            <div class="otp-actions">
              <button mat-button (click)="resendOtp()" [disabled]="loading || otpTimer > 540">
                <mat-icon>refresh</mat-icon> Resend OTP
              </button>
              <button mat-button (click)="goBackToForm()">
                <mat-icon>arrow_back</mat-icon> Back
              </button>
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Right Side: Goku Limitless Power -->
    <div class="model-section model-right" *ngIf="!isGoogleRegister">
      <div class="model-container">
        <iframe title="Son Goku (Limitless Power)" frameborder="0" allowfullscreen mozallowfullscreen="true"
          webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking"
          src="https://sketchfab.com/models/e60cddef445f43b4a3f80fa00cbf11d8/embed?ui_theme=dark&ui_controls=0&ui_infos=0&ui_stop=0&autostart=1&transparent=1">
        </iframe>
      </div>
    </div>
  </div>
</div>